%% cup experiment
d = 0.04337;

theta = [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
        0 0 0 1.5 1.5 1.5 1.5 1.5 1.5 1.5 1.5 1.5 1.5 1.5 1.5 1.5 1.5 1.5;
        0 0 0 1.5 1.5 1.5 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0;
        0 0 0 0.7 0.7 0.2 0.2 1.5 1.5 1.5 1.2 1.3 1.5 1.5 0.7 0.7 0.7 0.7];

phi = [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
        0 0 0 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5;
        0 0 0 0.5 0.5 0.5 0.5 5.5 5.5 5.5 5.5 5.5 5.5 5.5 5.5 5.5 5.5 5.5;
        0 0 0 0.5 0.5 0.5 0.5 5.5 5.5 5.5 3.5 3.5 3.5 3.5 3.5 3.5 3.5 3.5];
dL = [-0.04 -0.11 -0.11 -0.11 -0.11 -0.11 -0.11 -0.11 -0.11 -0.11 -0.11 -0.11 -0.11 -0.11 -0.11 -0.11 -0.11 -0.11;
    -0.03 -0.04 -0.06 -0.06 -0.06 -0.06 -0.06 -0.06 -0.06 -0.06 -0.06 -0.06 -0.06 -0.06 -0.06 -0.06 -0.06 -0.06;
    -0.0 -0.0 -0.0 -0.0 -0.0 -0.0 -0.04 -0.04 -0.04 -0.04 -0.04 -0.04 -0.04 -0.04 -0.04 -0.04 -0.04 -0.04;
    -0.0 -0.0 -0.0 -0.0 -0.0 -0.0 -0.0 -0.0 -0.0 -0.0 -0.0 -0.0 -0.0 -0.0 -0.03 -0.03 -0.03 -0.03];

dx = theta.*d.*cos(phi);
dy = theta.*d.*sin(phi);

motor = [0 0 1.6 1.6 1.6 1.6 1.6 1.6 1.25 1.25 1.55 1.8 1.8 1.9 2.0 2.1 2.3 2.7;
        -1.2 0 -1.0 -1.0 -0.5 -0.1 0.3 0.3 0.4 0.4 0.25 0.1 0.1 -0.1 -0.4 -0.8 -1.2 -0.5;
        -0.5 0 1.33 1.33 1.33 1.28 1.0 0.9 0.9 0.9 0.9 0.9 1.1 1.2 1.2 1.2 1.0 0.5;
        -1.2 0 0.0 0.95 0.3 -0.2 0.1 0.5 0.5 0.5 0.5 0.2 0.2 0.6 0.7 1.0 1.0 1.0];
wayPoints = [motor(1,:);dx(1,:);dy(1,:);dL(1,:);motor(2,:);dx(2,:);dy(2,:);dL(2,:);motor(3,:);
    dx(3,:);dy(3,:);dL(3,:); motor(4,:); dx(4,:);dy(4,:);dL(4,:)];

timePoints = [0 3 6 8 10 13 15 17 18 19 21 23 25 27 30 32 35 37];

tvec = 0:0.005:55;
tSamples = length(tvec);
[qd,dqd,ddqd,pp] = cubicpolytraj(wayPoints,timePoints,tvec);

save("clean/qd.mat", "qd")
save("clean/dqd.mat", "dqd")
save("clean/ddqd.mat", "ddqd")
save("clean/tvec.mat", "tvec")